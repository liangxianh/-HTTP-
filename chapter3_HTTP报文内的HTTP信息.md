## HTTP报文内的HTTP信息

> HTTP通信包括C端向S端的请求以及S端到C端的响应，下面了解一下请求和响应是如何运作的

1. HTTP报文：本身是由多行（用CR+LF作换行符）数据构成的字符串文本，大致分为报文首部和报文主体（不一定有），由空行（CR+LF）来划分
 > HTTP协议交互的信息被称为HTTP报文,请求端的报文叫做请求报文，响应端的叫做响应报文；
 > CR（Carriage Return回车符 16进制的0x0d）
 > LF（Line Feed换行符 16进制0x0a）

2. 结构
> 请求报文

|  主要包含 | 内容 | 说明 |
| :----: | :---: | :----: |
| 报文首部 | 请求行 | 包括请求方法，URI及HTTP版本 |
| - | 请求首部字段 | - |
| - | 通用首部字段 | - |
| - | 实体首部字段 | - |
| | 其他如cookie等 | - |
| 空行（CR_LF） | - | - |
| 报文主体 | - | - |

> 响应报文

|  主要包含 | 内容 | 说明 |
| :----: | :---: | :----: |
| 报文首部 | 状态行 | 包括响应结果状态码，原因短语和HTTP版本 |
| - | 响应首部字段 | - |
| - | 通用首部字段 | - |
| - | 实体首部字段 | - |
| - | 其他如cookie等 | - |
| 空行（CR_LF） | - | - |
| 报文主体 | - | - |

3. 编码提升传输速率

> HTTP报文主体和实体：主体用于传输请求和响应的实体主体通常报文主体等于报文实体；只有在传输过程中进行编码操作时实体内容发生变化，导致同博文主体产生差异

> 压缩传输的内容编码：服务器端可以将压缩后的资源作为响应实体传递到客户端，这个编码后的实体由客户端接收并负责解码；常用的内容编码由以下几种：
* gzip(GUN zip)  
* compress(UNIX系统的标准压缩)
* deflate（zlib）
* identity（不进行编码）

> 分割发送的分块传输编码：在通信过程中，在传输大容量数据时，通过把数据分割成多块（chunk），能够让浏览器逐步显示页面；这种把实体主体分块的功能称为分块传输编码（Chunked Transfer Coding）；使用CTC的实体主体会由接收的客户端负责解码恢复到编码前的实体主体

4. 发送多种数据的多部分对象集合

> HTTP协议中采纳了多部份对象集合，发送的一份报文主体可以包含有多类型的实体。通常在图片或文本文件等上传时使用；
* multipart/form-data  在web表单文件上次时使用
* multipart/byteranges 状态码206（部分内容）响应报文包含了多个范围的内容时使用

> 使用boundary字符串来化分多部分对象集合指明的各类实体，一般 又 --开头  --结尾 

5. 获取部分内容的范围请求

> 当资源很大时，如下载中断，不必重头开始，可以从之前下载中断处恢复下载；要实现该功能，需要进行指定范围发送的请求（即范围请求），执行范围请求时会用到首部字段Range来指定资源的byte范围如下
```
// 5001 - 10000字节
Range: bytes=5001-10000

// 5001字节之后的全部
Range: bytes=5001-

// 从开始到3000字节和从5000 大7000字节的多重范围
Range: bytes=0-3000， 5000-7000
```
> 针对范围请求，响应会返回状态码为206的响应报文；
> 对于多重范围的请求，响应会在首部字段Content-Type标明multipart/byteranges后返回响应报文；
> 若服务器无法响应范围请求，则会返回状态码200 OK 和完整的实体内容；

6. 内容协商返回最合适的内容：eg浏览器默认语言为英文或中文，访问相同的URI的web页面时，则会显示对应的英文版或中文版的web页面，这样的机制称为内容协商
> 内容协商机制是指客户端和服务端就响应资源内容进行交涉，然后提供给客户端最为适合的资源。会以语言、字符集、编码方式等为基准判断响应的资源。包含请求报文中的某些首部字段，如下：
* Accept
* Accept-Charset
* Accept-Encoding
* Accept-Language
* Content-Language

> 内容协商技术有以下3种类型
* 服务器驱动协商（Server-driven Negotiation）：以请求的首部字段为参考，服务端自动处理，不一定能筛选出最优的内容。
* 客户端驱动协商（Agent-driven Negotiation）：用户从浏览器显示的可选列表中手动选择，还可以利用js脚本在web页面上自动进行上述选择；比如按浏览器的类型或os的类型自行切换成pc版页面或手机版页面
* 透明协商（Transparent Negotiation）：是服务器和客户端各自进行内容协商的一种方法；












